# Privacy Query Engine - æ¶æ„è®¾è®¡æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

Privacy Query Engine æ˜¯ä¸€ä¸ªç”¨äº SQL æŸ¥è¯¢å’Œç»“æ„åŒ–æ•°æ®çš„éšç§ä¿æŠ¤å¼•æ“ï¼Œæ”¯æŒå·®åˆ†éšç§ (DP) å’Œå»æ ‡è¯†åŒ– (DeID) ä¸¤ç§ä¿æŠ¤æ–¹å¼ã€‚

## ç›®å½•ç»“æ„

```
main/
â”œâ”€â”€ __init__.py          # ä¸»å…¥å£ï¼Œå¯¼å‡ºæ ¸å¿ƒ API
â”œâ”€â”€ __main__.py          # CLI å…¥å£
â”‚
â”œâ”€â”€ core/                # ğŸ¯ æ ¸å¿ƒæ§åˆ¶å±‚
â”‚   â”œâ”€â”€ driver.py        # QueryDriver - ä¸»åè°ƒå™¨
â”‚   â””â”€â”€ context.py       # QueryContext - æŸ¥è¯¢ä¸Šä¸‹æ–‡
â”‚
â”œâ”€â”€ analyzer/            # ğŸ” SQL åˆ†æå±‚
â”‚   â”œâ”€â”€ sql_analyzer.py  # SQL è¯­ä¹‰åˆ†æå™¨
â”‚   â””â”€â”€ models.py        # åˆ†æç»“æœæ¨¡å‹
â”‚
â”œâ”€â”€ policy/              # ğŸ“‹ ç­–ç•¥å†³ç­–å±‚
â”‚   â”œâ”€â”€ engine.py        # PolicyEngine - ç­–ç•¥å¼•æ“
â”‚   â””â”€â”€ config.py        # ConfigManager - é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ privacy/             # ğŸ” éšç§ä¿æŠ¤å±‚
â”‚   â”œâ”€â”€ dp/              # å·®åˆ†éšç§
â”‚   â”‚   â”œâ”€â”€ rewriter.py  # DPRewriter
â”‚   â”‚   â”œâ”€â”€ mechanisms.py # Laplace/Gaussian æœºåˆ¶
â”‚   â”‚   â””â”€â”€ sensitivity.py # æ•æ„Ÿåº¦åˆ†æ
â”‚   â””â”€â”€ deid/            # å»æ ‡è¯†åŒ–
â”‚       â”œâ”€â”€ rewriter.py  # DeIDRewriter
â”‚       â””â”€â”€ methods.py   # è„±æ•æ–¹æ³•é›†åˆ
â”‚
â”œâ”€â”€ executor/            # âš¡ æŸ¥è¯¢æ‰§è¡Œå±‚
â”‚   â”œâ”€â”€ query_executor.py # QueryExecutor
â”‚   â”œâ”€â”€ database.py      # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ mock.py          # Mock æ‰§è¡Œå™¨
â”‚
â”œâ”€â”€ data/                # ğŸ“Š æ•°æ®å¤„ç†å±‚
â”‚   â”œâ”€â”€ csv_processor.py # CSV/DataFrame å¤„ç†å™¨
â”‚   â””â”€â”€ schema_detector.py # æ¨¡å¼è‡ªåŠ¨æ£€æµ‹
â”‚
â”œâ”€â”€ evaluation/          # ğŸ“ˆ è¯„ä¼°å±‚ 
â”‚   â”œâ”€â”€ evaluator.py     # ç»¼åˆè¯„ä¼°å™¨
â”‚   â”œâ”€â”€ privacy_metrics.py # éšç§æŒ‡æ ‡
â”‚   â””â”€â”€ utility_metrics.py # å¯ç”¨æ€§æŒ‡æ ‡
â”‚
â”œâ”€â”€ budget/              # ğŸ’° é¢„ç®—ç®¡ç†
â”œâ”€â”€ audit/               # ğŸ“ å®¡è®¡æ—¥å¿—
â”œâ”€â”€ performance/         # ğŸš€ æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ distributed/         # ğŸŒ åˆ†å¸ƒå¼æ”¯æŒ
â”œâ”€â”€ api/                 # ğŸŒ HTTP API
â””â”€â”€ examples/            # ğŸ“š ä½¿ç”¨ç¤ºä¾‹
```

## æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Privacy Query Engine                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   API å±‚    â”‚    â”‚  CLI å…¥å£   â”‚    â”‚  SDK è°ƒç”¨   â”‚                 â”‚
â”‚  â”‚  (FastAPI)  â”‚    â”‚ (__main__)  â”‚    â”‚  (import)   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                  â”‚                  â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Core - æ ¸å¿ƒæ§åˆ¶å±‚                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚
â”‚  â”‚  â”‚   QueryDriver   â”‚    â”‚  QueryContext   â”‚                     â”‚   â”‚
â”‚  â”‚  â”‚   (åè°ƒå™¨)      â”‚    â”‚   (ä¸Šä¸‹æ–‡)      â”‚                     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        å¤„ç†æµæ°´çº¿                                  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚ Analyzer â”‚ â†’ â”‚  Policy  â”‚ â†’ â”‚ Privacy  â”‚ â†’ â”‚ Executor â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ SQLåˆ†æ  â”‚   â”‚ ç­–ç•¥å†³ç­– â”‚   â”‚ éšç§å¤„ç† â”‚   â”‚ æŸ¥è¯¢æ‰§è¡Œ â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        æ•°æ®å¤„ç†å±‚                                  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚  CSVProcessor    â”‚    â”‚  SchemaDetector  â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚  CSV/DF å¤„ç†     â”‚    â”‚  æ¨¡å¼è‡ªåŠ¨æ£€æµ‹    â”‚                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        è¯„ä¼°å±‚                                      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚  PrivacyMetrics  â”‚    â”‚  UtilityMetrics  â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚  éšç§æŒ‡æ ‡è¯„ä¼°    â”‚    â”‚  å¯ç”¨æ€§æŒ‡æ ‡è¯„ä¼°  â”‚                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ â”‚
â”‚  â”‚                      â–¼                                            â”‚ â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚ â”‚
â”‚  â”‚           â”‚    Evaluator     â”‚                                    â”‚ â”‚
â”‚  â”‚           â”‚   ç»¼åˆè¯„ä¼°æŠ¥å‘Š   â”‚                                    â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        æ”¯æ’‘å±‚                                      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚ Budget â”‚  â”‚ Audit  â”‚  â”‚ Cache  â”‚  â”‚Distrib â”‚  â”‚ Models â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ é¢„ç®—   â”‚  â”‚ å®¡è®¡   â”‚  â”‚ ç¼“å­˜   â”‚  â”‚ åˆ†å¸ƒå¼ â”‚  â”‚ æ•°æ®æ¨¡å‹â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¨¡å—èŒè´£

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | èŒè´£ | å…³é”®ç±» |
|------|------|--------|
| `core` | åè°ƒæ•´ä¸ªå¤„ç†æµç¨‹ | `QueryDriver`, `QueryContext` |
| `analyzer` | SQL è¯­ä¹‰åˆ†æ | `SQLAnalyzer`, `AnalysisResult` |
| `policy` | ç­–ç•¥å†³ç­– | `PolicyEngine`, `PolicyDecision` |
| `privacy` | éšç§ä¿æŠ¤å®ç° | `DPRewriter`, `DeIDRewriter` |
| `executor` | æŸ¥è¯¢æ‰§è¡Œ | `QueryExecutor`, `DatabaseConnection` |

### æ•°æ®å¤„ç†æ¨¡å—

| æ¨¡å— | èŒè´£ | å…³é”®ç±» |
|------|------|--------|
| `data` | ç»“æ„åŒ–æ•°æ®å¤„ç† | `CSVPrivacyProcessor`, `SchemaDetector` |

### è¯„ä¼°æ¨¡å—

| æ¨¡å— | èŒè´£ | å…³é”®ç±» |
|------|------|--------|
| `evaluation` | éšç§-å¯ç”¨æ€§è¯„ä¼° | `PrivacyUtilityEvaluator`, `EvaluationReport` |

### æ”¯æ’‘æ¨¡å—

| æ¨¡å— | èŒè´£ | å…³é”®ç±» |
|------|------|--------|
| `budget` | éšç§é¢„ç®—ç®¡ç† | `PrivacyBudgetManager` |
| `audit` | å®¡è®¡æ—¥å¿— | `AuditLogger` |
| `performance` | æ€§èƒ½ä¼˜åŒ– | `QueryCache`, `RateLimiter` |
| `distributed` | åˆ†å¸ƒå¼æ”¯æŒ | `DistributedCoordinator` |
| `api` | HTTP æœåŠ¡ | `create_app`, `routes` |

## æ•°æ®æµ

### SQL æŸ¥è¯¢å¤„ç†æµç¨‹

```
åŸå§‹ SQL
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analyzer   â”‚  è§£æ SQLï¼Œæå–è¡¨ã€åˆ—ã€èšåˆå‡½æ•°ç­‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ AnalysisResult
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Policy    â”‚  æ ¹æ®åˆ†æç»“æœå†³å®šä¿æŠ¤æ–¹å¼ (DP/DeID/PASS)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ PolicyDecision
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Executor   â”‚  æ‰§è¡ŒæŸ¥è¯¢ + åº”ç”¨éšç§ä¿æŠ¤
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  ä¿æŠ¤åçš„ç»“æœ
```

### CSV æ•°æ®å¤„ç†æµç¨‹

```
CSV æ–‡ä»¶/DataFrame
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SchemaDetector  â”‚  è‡ªåŠ¨æ£€æµ‹åˆ—ç±»å‹å’Œæ•æ„Ÿåº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ DataSchema
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSVProcessor    â”‚  åº”ç”¨è„±æ•æ–¹æ³• + K-åŒ¿å/L-å¤šæ ·æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ProcessingResult
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Evaluator     â”‚  è¯„ä¼°éšç§ä¿æŠ¤å’Œæ•°æ®å¯ç”¨æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   EvaluationReport
```

## è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½é¢†åŸŸã€‚

### 2. å¼€é—­åŸåˆ™
- é€šè¿‡é…ç½®æ–‡ä»¶æ‰©å±•ç­–ç•¥è§„åˆ™
- é€šè¿‡æ³¨å†Œæœºåˆ¶æ·»åŠ æ–°çš„è„±æ•æ–¹æ³•
- é€šè¿‡æ¥å£æŠ½è±¡æ”¯æŒå¤šç§æ•°æ®åº“

### 3. ä¾èµ–å€’ç½®
- æ ¸å¿ƒæ¨¡å—ä¸ä¾èµ–å…·ä½“å®ç°
- é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºå®ä¾‹
- æ”¯æŒ Mock æ¨¡å¼ä¾¿äºæµ‹è¯•

### 4. æ— éœ€é¢„å®šä¹‰è¡¨ç»“æ„
- `SchemaDetector` è‡ªåŠ¨æ£€æµ‹æ•°æ®æ¨¡å¼
- `SQLAnalyzer` åŠ¨æ€è§£æ SQL
- æ”¯æŒä»»æ„æ•°æ®åº“è¡¨ç»“æ„

## æ‰©å±•ç‚¹

### æ·»åŠ æ–°çš„è„±æ•æ–¹æ³•

```python
# åœ¨ main/privacy/deid/methods.py ä¸­æ·»åŠ 
def my_custom_method(value: Any) -> Any:
    # å®ç°è„±æ•é€»è¾‘
    return processed_value

# åœ¨ DeIDRewriter.METHODS ä¸­æ³¨å†Œ
METHODS["my_method"] = my_custom_method
```

### æ·»åŠ æ–°çš„ç­–ç•¥è§„åˆ™

```yaml
# åœ¨ config/policy.yaml ä¸­æ·»åŠ 
column_patterns:
  - pattern: "^credit_card.*$"
    classification: restricted
    privacy_method: hash
    params:
      length: 8
```

### æ·»åŠ æ–°çš„è¯„ä¼°æŒ‡æ ‡

```python
# ç»§æ‰¿æˆ–æ‰©å±• PrivacyMetrics/UtilityMetrics
@dataclass
class ExtendedPrivacyMetrics(PrivacyMetrics):
    my_custom_metric: float = 0.0
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ SQL æŸ¥è¯¢

```python
from main import QueryDriver

driver = QueryDriver()
result = driver.process_query("SELECT COUNT(*) FROM users")
```

### CSV å¤„ç†

```python
from main import CSVPrivacyProcessor
from main.data.csv_processor import ProcessingConfig

processor = CSVPrivacyProcessor()
config = ProcessingConfig(
    auto_detect=True,
    k_anonymity=5,
    quasi_identifiers=["age", "zipcode"]
)
result = processor.process_file("data.csv", config)
```

### è¯„ä¼°è„±æ•æ•ˆæœ

```python
from main import PrivacyUtilityEvaluator, EvaluationConfig

evaluator = PrivacyUtilityEvaluator()
config = EvaluationConfig(
    quasi_identifiers=["age", "zipcode"],
    sensitive_attribute="disease",
    target_k=5
)
report = evaluator.evaluate(original_data, protected_data, config)
print(report.summary())
```

## ç‰ˆæœ¬å†å²

- v1.0.0: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒ SQL æŸ¥è¯¢çš„ DP/DeID ä¿æŠ¤
- v2.0.0: æ–°å¢ CSV å¤„ç†å™¨å’Œéšç§-å¯ç”¨æ€§è¯„ä¼°æ¨¡å—


## æ¶æ„è¯„ä¼°ä¸ä¼˜åŒ–å»ºè®®

### å½“å‰æ¶æ„ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| âœ… æ¨¡å—åŒ–æ¸…æ™° | æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œè¾¹ç•Œæ¸…æ™° |
| âœ… å¯æ‰©å±•æ€§å¼º | é€šè¿‡é…ç½®å’Œæ³¨å†Œæœºåˆ¶è½»æ¾æ‰©å±• |
| âœ… æ— éœ€é¢„å®šä¹‰è¡¨ç»“æ„ | SchemaDetector è‡ªåŠ¨æ£€æµ‹ |
| âœ… å¤šç§æ•°æ®æºæ”¯æŒ | SQLã€CSVã€DataFrame |
| âœ… å®Œæ•´çš„è¯„ä¼°ä½“ç³» | éšç§å’Œå¯ç”¨æ€§åŒç»´åº¦è¯„ä¼° |
| âœ… ç”Ÿäº§å°±ç»ª | å®¡è®¡ã€ç¼“å­˜ã€é™æµã€åˆ†å¸ƒå¼æ”¯æŒ |

### æ¨¡å—ä¾èµ–å…³ç³»ï¼ˆç®€åŒ–ï¼‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API   â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                    â”‚  Core   â”‚ â—„â”€â”€â”€ å”¯ä¸€å…¥å£
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Analyzer â”‚    â”‚ Policy  â”‚    â”‚Executor â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                        â”‚              â”‚
                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                   â”‚ Privacy â”‚    â”‚Database â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—æ•°é‡ç»Ÿè®¡

| å±‚çº§ | æ¨¡å—æ•° | è¯´æ˜ |
|------|--------|------|
| æ ¸å¿ƒå¤„ç† | 5 | core, analyzer, policy, privacy, executor |
| æ•°æ®å¤„ç† | 1 | data |
| è¯„ä¼° | 1 | evaluation |
| æ”¯æ’‘æœåŠ¡ | 5 | budget, audit, performance, distributed, api |
| **æ€»è®¡** | **12** | ç²¾ç®€ä¸”å®Œæ•´ |

### å»ºè®®çš„ç®€åŒ–æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç²¾ç®€ï¼Œå¯ä»¥è€ƒè™‘ï¼š

```
main/
â”œâ”€â”€ core/           # åˆå¹¶ driver + context
â”œâ”€â”€ analyzer/       # ä¿æŒ
â”œâ”€â”€ policy/         # ä¿æŒ
â”œâ”€â”€ privacy/        # åˆå¹¶ dp + deid
â”œâ”€â”€ executor/       # ä¿æŒ
â”œâ”€â”€ data/           # ä¿æŒ (æ–°å¢)
â”œâ”€â”€ evaluation/     # ä¿æŒ (æ–°å¢)
â”œâ”€â”€ infra/          # åˆå¹¶ budget + audit + performance + distributed
â””â”€â”€ api/            # ä¿æŒ
```

è¿™æ ·å¯ä»¥å°† 12 ä¸ªæ¨¡å—ç²¾ç®€ä¸º 9 ä¸ªï¼Œä½†å½“å‰ç»“æ„å·²ç»è¶³å¤Ÿæ¸…æ™°ï¼Œä¸å»ºè®®è¿‡åº¦åˆå¹¶ã€‚

## å¿«é€Ÿä½¿ç”¨æŒ‡å—

### 1. SQL æŸ¥è¯¢ä¿æŠ¤

```python
from main import QueryDriver

# åˆ›å»ºé©±åŠ¨å™¨
driver = QueryDriver()  # Mock æ¨¡å¼
# driver = QueryDriver.create(host="localhost", database="mydb", ...)  # çœŸå®æ•°æ®åº“

# å¤„ç†æŸ¥è¯¢ï¼ˆè‡ªåŠ¨åº”ç”¨éšç§ä¿æŠ¤ï¼‰
result = driver.process_query("SELECT COUNT(*) FROM users WHERE age > 18")
```

### 2. CSV æ•°æ®è„±æ•

```python
from main import CSVPrivacyProcessor
from main.data.csv_processor import ProcessingConfig

processor = CSVPrivacyProcessor()
config = ProcessingConfig(
    auto_detect=True,           # è‡ªåŠ¨æ£€æµ‹æ•æ„Ÿåˆ—
    k_anonymity=5,              # K-åŒ¿ååŒ–
    quasi_identifiers=["age", "zipcode"],
)

result = processor.process_file("data.csv", config)
processor.save_csv(result.data, "protected.csv")
```

### 3. è¯„ä¼°è„±æ•æ•ˆæœ

```python
from main import PrivacyUtilityEvaluator, EvaluationConfig

evaluator = PrivacyUtilityEvaluator()
config = EvaluationConfig(
    quasi_identifiers=["age", "zipcode"],
    sensitive_attribute="disease",
    target_k=5,
)

report = evaluator.evaluate(original_data, protected_data, config)
print(report.summary())
```

### 4. å¯åŠ¨ API æœåŠ¡

```bash
uvicorn main.api.server:app --reload --port 8000
```

## æ€»ç»“

å½“å‰æ¶æ„å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ¸…æ™°** - 12 ä¸ªæ¨¡å—ï¼ŒèŒè´£åˆ†æ˜
2. **ç®€æ´** - æ— å†—ä½™ä»£ç ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®ç”¨é€”
3. **å¥å£®** - å®Œæ•´çš„é”™è¯¯å¤„ç†ã€å®¡è®¡ã€ç¼“å­˜æœºåˆ¶
4. **å¯æ‰©å±•** - é€šè¿‡é…ç½®å’Œæ¥å£è½»æ¾æ‰©å±•
5. **æ˜“ç”¨** - æä¾›å¤šç§ä½¿ç”¨æ–¹å¼ï¼ˆSDKã€CLIã€APIï¼‰

é¡¹ç›®å·²å‡†å¤‡å¥½ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚
